openapi: 3.0.1
info:
  title: Pentaho Scheduler API
  version: 1.0.0
  description: REST API for managing scheduled jobs and blockouts in Pentaho.

servers:
  - url: http://localhost:8080/pentaho/plugin
tags:
  - name: i-scheduler
    description: Scheduler operations
paths:
  /api/v1/scheduler/job:
    post:
      summary: Creates or updates a scheduled job
      tags:
        - i-scheduler
      requestBody:
        required: true
        content:
          application/xml:
            schema:
              oneOf:
                - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                - $ref: '#/components/schemas/DailyJobScheduleRequest'
                - $ref: '#/components/schemas/CronJobScheduleRequest'
                - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                - $ref: '#/components/schemas/YearlyJobScheduleRequest'
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                - $ref: '#/components/schemas/DailyJobScheduleRequest'
                - $ref: '#/components/schemas/CronJobScheduleRequest'
                - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                - $ref: '#/components/schemas/YearlyJobScheduleRequest'
      responses:
        '200':
          description: Schedule created or updated successfully
          content:
            text/plain:
              schema:
                type: string
        '401':
          description: User is not authorized to create or update schedules
        '403':
            description: Cannot create schedules for the specified file
        '500':
          description: An error occurred while creating or updating a schedule

  /api/v1/scheduler/triggerNow:
    post:
      summary: Execute a previously scheduled job
      tags:
        - i-scheduler
      requestBody:
        required: true
        content:
          application/xml:
            schema: { type: string }
          application/json:
            schema: { type: string }
      responses:
        '200':
          description: Job triggered successfully
          content:
            text/plain:
              schema:
                type: string
        '400':
          description: Invalid input
        '500':
          description: Invalid jobId

  /api/v1/scheduler/getContentCleanerJob:
    get:
      summary: Get the scheduled job for deleting generated files
      tags:
        - i-scheduler
      responses:
        '200':
          description: Content cleaner job successfully retrieved
          content:
            application/xml:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                  - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                  - $ref: '#/components/schemas/DailyJobScheduleRequest'
                  - $ref: '#/components/schemas/CronJobScheduleRequest'
                  - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                  - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                  - $ref: '#/components/schemas/YearlyJobScheduleRequest'
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                  - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                  - $ref: '#/components/schemas/DailyJobScheduleRequest'
                  - $ref: '#/components/schemas/CronJobScheduleRequest'
                  - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                  - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                  - $ref: '#/components/schemas/YearlyJobScheduleRequest'
        '204':
          description: No content cleaner job exists

  /api/v1/scheduler/getJobs:
    get:
      summary: Retrieve all scheduled jobs visible to the current user
      tags:
        - i-scheduler
      responses:
        '200':
          description: Jobs retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  oneOf:
                    - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                    - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                    - $ref: '#/components/schemas/DailyJobScheduleRequest'
                    - $ref: '#/components/schemas/CronJobScheduleRequest'
                    - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                    - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                    - $ref: '#/components/schemas/YearlyJobScheduleRequest'
            application/xml:
              schema:
                type: array
                items:
                  oneOf:
                    - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                    - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                    - $ref: '#/components/schemas/DailyJobScheduleRequest'
                    - $ref: '#/components/schemas/CronJobScheduleRequest'
                    - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                    - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                    - $ref: '#/components/schemas/YearlyJobScheduleRequest'
        '500':
          description: Error while retrieving jobs

  /api/v1/scheduler/isScheduleAllowed:
    get:
      summary: Checks whether the current user may schedule a repository file
      tags:
        - i-scheduler
      parameters:
        - in: query
          name: id
          schema: { type: string }
          required: true
      responses:
        '200':
          description: Scheduling ability retrieved
          content:
            text/plain:
              schema: { type: string }
        '500':
          description: Invalid repository file id

  /api/v1/scheduler/canSchedule:
    get:
      summary: Checks whether the current user can schedule any content
      tags:
        - i-scheduler
      responses:
        '200':
          description: Scheduling permission retrieved
          content:
            application/json:
              schema: { type: string }
        '500':
          description: Unable to retrieve the scheduling permission

  /api/v1/scheduler/canExecuteSchedules:
    get:
      summary: Checks whether the current user can execute schedules
      tags:
        - i-scheduler
      responses:
        '200':
          description: Scheduling execution permission retrieved
          content:
            application/json:
              schema: { type: string }
        '500':
          description: Unable to retrieve the scheduling permission

  /api/v1/scheduler/state:
    get:
      summary: Returns the state of the scheduler
      tags:
        - i-scheduler
      responses:
        '200':
          description: Scheduler state retrieved
          content:
            text/plain:
              schema: { type: string }
        '500':
          description: Error getting scheduler state

  /api/v1/scheduler/start:
    post:
      summary: Resume the scheduler from a paused state
      tags:
        - i-scheduler
      responses:
        '200':
          description: Scheduler started
          content:
            text/plain:
              schema: { type: string }
        '500':
          description: Error resuming scheduler

  /api/v1/scheduler/pause:
    post:
      summary: Pause the scheduler from a running state
      tags:
        - i-scheduler
      responses:
        '200':
          description: Scheduler paused
          content:
            text/plain:
              schema: { type: string }
        '500':
          description: Error pausing scheduler

  /api/v1/scheduler/shutdown:
    post:
      summary: Shuts down the scheduler
      tags:
        - i-scheduler
      responses:
        '200':
          description: Scheduler shut down
          content:
            text/plain:
              schema: { type: string }
        '500':
          description: Error shutting down scheduler

  /api/v1/scheduler/jobState:
    post:
      summary: Checks the state of the selected scheduled job
      tags:
        - i-scheduler
      requestBody:
        required: true
        content:
          application/xml:
            schema: { type: string }
          application/json:
            schema: { type: string }
      responses:
        '200':
          description: Job state retrieved
          content:
            text/plain:
              schema: { type: string }
        '500':
          description: Invalid jobId

  /api/v1/scheduler/pauseJob:
    post:
      summary: Pause the specified scheduled job
      tags:
        - i-scheduler
      requestBody:
        required: true
        content:
          application/xml:
            schema: { type: string }
          application/json:
            schema: { type: string }
      responses:
        '200':
          description: Job paused
          content:
            text/plain:
              schema: { type: string }
        '500':
          description: Invalid jobId

  /api/v1/scheduler/resumeJob:
    post:
      summary: Resume the specified scheduled job
      tags:
        - i-scheduler
      requestBody:
        required: true
        content:
          application/xml:
            schema: { type: string }
          application/json:
            schema: { type: string }
      responses:
        '200':
          description: Job resumed
          content:
            text/plain:
              schema: { type: string }
        '500':
          description: Invalid jobId

  /api/v1/scheduler/removeJob:
    put:
      summary: Delete the specified scheduled job
      tags:
        - i-scheduler
      requestBody:
        required: true
        content:
          application/xml:
            schema: { type: string }
          application/json:
            schema: { type: string }
      responses:
        '200':
          description: Job removed
          content:
            text/plain:
              schema: { type: string }
        '500':
          description: Invalid jobId

  /api/v1/scheduler/removeJobs:
    post:
      summary: Deletes all the specified scheduled jobs
      tags:
        - i-scheduler
      requestBody:
        required: true
        content:
          application/xml:
            schema:
              type: array
              items:
                type: string
          application/json:
            schema:
              type: array
              items:
                type: string
      responses:
        '200':
          description: Jobs new states returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JobStatusResponse'
            application/xml:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JobStatusResponse'
        '500':
          description: Invalid request or server error

  /api/v1/scheduler/jobinfo:
    get:
      summary: Return the information for a specified job
      tags:
        - i-scheduler
      parameters:
        - in: query
          name: jobId
          schema: { type: string }
          required: true
        - in: query
          name: asCronString
          schema: { type: string }
          required: false
      responses:
        '200':
          description: Job info retrieved
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                  - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                  - $ref: '#/components/schemas/DailyJobScheduleRequest'
                  - $ref: '#/components/schemas/CronJobScheduleRequest'
                  - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                  - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                  - $ref: '#/components/schemas/YearlyJobScheduleRequest'
            application/xml:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                  - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                  - $ref: '#/components/schemas/DailyJobScheduleRequest'
                  - $ref: '#/components/schemas/CronJobScheduleRequest'
                  - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                  - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                  - $ref: '#/components/schemas/YearlyJobScheduleRequest'
        '204':
          description: Job does not exist
        '500':
          description: Internal error or invalid jobId

  /api/v1/scheduler/blockout/blockoutjobs:
    get:
      summary: Get all the blockout jobs in the system
      tags:
        - i-scheduler
      responses:
        '200':
          description: Blockout jobs retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  oneOf:
                    - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                    - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                    - $ref: '#/components/schemas/DailyJobScheduleRequest'
                    - $ref: '#/components/schemas/CronJobScheduleRequest'
                    - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                    - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                    - $ref: '#/components/schemas/YearlyJobScheduleRequest'
            application/xml:
              schema:
                type: array
                items:
                  oneOf:
                    - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                    - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                    - $ref: '#/components/schemas/DailyJobScheduleRequest'
                    - $ref: '#/components/schemas/CronJobScheduleRequest'
                    - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                    - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                    - $ref: '#/components/schemas/YearlyJobScheduleRequest'
        '500':
          description: Error while retrieving blockout jobs

  /api/v1/scheduler/blockout/hasblockouts:
    get:
      summary: Checks if there are blockouts in the system
      tags:
        - i-scheduler
      responses:
        '200':
          description: Blockout status
          content:
            text/plain:
              schema: { type: string }

  /api/v1/scheduler/blockout/add:
    post:
      summary: Creates a new blockout for scheduled jobs
      tags:
        - i-scheduler
      requestBody:
        required: true
        content:
          application/xml:
            schema:
              oneOf:
                - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                - $ref: '#/components/schemas/DailyJobScheduleRequest'
                - $ref: '#/components/schemas/CronJobScheduleRequest'
                - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                - $ref: '#/components/schemas/YearlyJobScheduleRequest'
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                - $ref: '#/components/schemas/DailyJobScheduleRequest'
                - $ref: '#/components/schemas/CronJobScheduleRequest'
                - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                - $ref: '#/components/schemas/YearlyJobScheduleRequest'
      responses:
        '200':
          description: Blockout created
          content:
            text/plain:
              schema: { type: string }
        '401':
          description: Not authorized

  /api/v1/scheduler/blockout/willFire:
    post:
      summary: Checks if the selected blockout schedule will be fired
      tags:
        - i-scheduler
      requestBody:
        required: true
        content:
          application/xml:
            schema:
              oneOf:
                - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                - $ref: '#/components/schemas/DailyJobScheduleRequest'
                - $ref: '#/components/schemas/CronJobScheduleRequest'
                - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                - $ref: '#/components/schemas/YearlyJobScheduleRequest'
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                - $ref: '#/components/schemas/DailyJobScheduleRequest'
                - $ref: '#/components/schemas/CronJobScheduleRequest'
                - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                - $ref: '#/components/schemas/YearlyJobScheduleRequest'
      responses:
        '200':
          description: Will fire status
          content:
            text/plain:
              schema: { type: string }
        '500':
          description: Error determining blockout firing

  /api/v1/scheduler/blockout/shouldFireNow:
    get:
      summary: Checks if the selected blockout schedule should be fired now
      tags:
        - i-scheduler
      responses:
        '200':
          description: Should fire now status
          content:
            text/plain:
              schema: { type: string }

  /api/v1/scheduler/blockout/blockstatus:
    post:
      summary: Check the status of the selected blockout schedule
      tags:
        - i-scheduler
      requestBody:
        required: true
        content:
          application/xml:
            schema:
              oneOf:
                - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                - $ref: '#/components/schemas/DailyJobScheduleRequest'
                - $ref: '#/components/schemas/CronJobScheduleRequest'
                - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                - $ref: '#/components/schemas/YearlyJobScheduleRequest'
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/RunOnceJobScheduleRequest'
                - $ref: '#/components/schemas/SecondsJobScheduleRequest'
                - $ref: '#/components/schemas/DailyJobScheduleRequest'
                - $ref: '#/components/schemas/CronJobScheduleRequest'
                - $ref: '#/components/schemas/WeeklyJobScheduleRequest'
                - $ref: '#/components/schemas/MonthlyJobScheduleRequest'
                - $ref: '#/components/schemas/YearlyJobScheduleRequest'
      responses:
        '200':
          description: Blockout status
          content:
            application/json:
              schema: { $ref: '#/components/schemas/BlockStatusProxy' }
            application/xml:
              schema: { $ref: '#/components/schemas/BlockStatusProxy' }
        '401':
          description: Not authorized

  /api/v1/scheduler/generatedContentForSchedule:
    get:
      summary: Retrieve the list of execute content by lineage id
      tags:
        - i-scheduler
      parameters:
        - in: query
          name: lineageId
          schema: { type: string }
          required: true
      responses:
        '200':
          description: Generated content for schedule
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/RepositoryFileDto' }
            application/xml:
              schema:
                type: array
                items: { $ref: '#/components/schemas/RepositoryFileDto' }

components:
  schemas:

    JobStatusResponse:
      type: object
      properties:
        jobId:
          type: string
        status:
          type: string

    JobParam:
      type: object
      properties:
        name:
          type: string
        value:
          type: string
        type:
          type: string

    BaseJob:
      type: object
      properties:
        jobId:
          type: string
        jobName:
          type: string
        startDate:
          type: string
          format: date-time
        inputFile:
          type: string
        outputFile:
          type: string
          nullable: true
        timeZone:
          type: string
        enableSafeMode:
          type: boolean
        gatheringMetrics:
          type: boolean
        logLevel:
          type: string
        userName:
          type: string
        jobParams:
          type: array
          items:
            $ref: '#/components/schemas/JobParam'
        parameters:
          type: array
          items:
            $ref: '#/components/schemas/JobParam'
        state:
          type: string
          nullable: true
        nextRun:
          type: string
          format: date-time
          nullable: true
        lastRun:
          type: string
          format: date-time
          nullable: true


    RunOnceJobScheduleRequest:
      allOf:
        - $ref: '#/components/schemas/BaseJob'

    SecondsJobScheduleRequest:
      allOf:
        - $ref: '#/components/schemas/BaseJob'
      type: object
      properties:
          repeatInterval:
            type: integer

    DailyJobScheduleRequest:
      allOf:
        - $ref: '#/components/schemas/BaseJob'
      type: object
      properties:
        repeatInterval:
          type: integer
        ignoreDST:
          type: boolean
        isEveryNDays:
          type: boolean
        endDate:
          type: string
          format: date-time
          nullable: true

    CronJobScheduleRequest:
      allOf:
        - $ref: '#/components/schemas/BaseJob'
      type: object
      properties:
        cronExpression:
          type: string
        cronDescription:
          type: string
        endDate:
          type: string
          format: date-time
          nullable: true

    WeeklyJobScheduleRequest:
      allOf:
        - $ref: '#/components/schemas/BaseJob'
      type: object
      properties:
        daysOfWeek:
          type: array
          items:
            type: string
            enum:
              - Sunday
              - Monday
              - Tuesday
              - Wednesday
              - Thursday
              - Friday
              - Saturday
        endDate:
          type: string
          format: date-time
          nullable: true

    MonthlyJobScheduleRequest:
      allOf:
        - $ref: '#/components/schemas/BaseJob'
      type: object
      properties:
        dayOfMonth:
          type: integer
        weekOfMonth:
          type: string
          enum:
            - first
            - second
            - third
            - fourth
            - last
        dayOfWeek:
          type: string
          enum:
            - Sunday
            - Monday
            - Tuesday
            - Wednesday
            - Thursday
            - Friday
            - Saturday
        endDate:
          type: string
          format: date-time
          nullable: true

    YearlyJobScheduleRequest:
      allOf:
        - $ref: '#/components/schemas/BaseJob'
      type: object
      properties:
        dayOfMonth:
          type: integer
        monthOfYear:
          type: integer
        weekOfMonth:
          type: string
          enum:
            - first
            - second
            - third
            - fourth
            - last
        dayOfWeek:
          type: string
          enum:
            - Sunday
            - Monday
            - Tuesday
            - Wednesday
            - Thursday
            - Friday
            - Saturday
        endDate:
          type: string
          format: date-time
          nullable: true

    BlockStatusProxy:
      type: object
      properties:
        partiallyBlocked:
          type: boolean
        totallyBlocked:
          type: boolean

    RepositoryFileDto:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        path:
          type: string
        title:
          type: string
        createdDate:
          type: integer
        lastModifiedDate:
          type: integer
        fileSize:
          type: integer
        folder:
          type: boolean
        hidden:
          type: boolean
        locked:
          type: boolean
        locale:
          type: string
        versionId:
          type: string
        versioned:
          type: boolean
        originalParentFolderPath:
          type: string
        ownerType:
          type: integer
        localePropertiesMapEntries:
          type: array
          items:
            type: object